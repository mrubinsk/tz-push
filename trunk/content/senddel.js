/* Copyright (c) 2012 Mark Nethersole
   See the file LICENSE.txt for licensing information. */
function mycallback2(returnedwbxml) {
wbxml=returnedwbxml
synckey = FindKey(wbxml)
prefs.setCharPref("synckey",synckey)
var entries = file.directoryEntries;
while (entries.hasMoreElements()){
entry = entries.getNext()   
entry.QueryInterface(Components.interfaces.nsIFile)
entry.remove("true")
}
}
function senddel() {
wbxmlouter = String.fromCharCode(0x03,0x01,0x6A,0x00,0x45,0x5C,0x4F,0x50,0x03,0x43,0x6F,0x6E,0x74,0x61,0x63,0x74,0x73,0x00,0x01,0x4B,0x03,0x53,0x79,0x6E,0x63,0x4B,0x65,0x79,0x52,0x65,0x70,0x6C,0x61,0x63,0x65,0x00,0x01,0x52,0x03,0x49,0x64,0x32,0x52,0x65,0x70,0x6C,0x61,0x63,0x65,0x00,0x01,0x57,0x5B,0x03,0x31,0x00,0x01,0x62,0x03,0x30,0x00,0x01,0x01,0x56,0x72,0x65,0x70,0x6C,0x61,0x63,0x65,0x68,0x65,0x72,0x65,0x01,0x01,0x01,0x01)

wbxml= ''
numofdel = 0
Components.utils.import("resource://gre/modules/FileUtils.jsm")
file = FileUtils.getFile("ProfD", ["DeletedCards"],true);
entries = file.directoryEntries;
while (entries.hasMoreElements())
{
numofdel = numofdel + 1
entry = entries.getNext()
entry.QueryInterface(Components.interfaces.nsIFile)
deletedcards = entry.leafName
wbxml = wbxml + String.fromCharCode(0x49,0x4D,0x03) + deletedcards + String.fromCharCode(0x00,0x01,0x01)
}
wbxmlinner = wbxml
wbxml = wbxmlouter.replace('replacehere',wbxmlinner)
wbxml = wbxml.replace('SyncKeyReplace',synckey)
wbxml = wbxml.replace('Id2Replace',folderID)
if (numofdel > 0) {
wbxml = Send(wbxml,mycallback2)

}

}

